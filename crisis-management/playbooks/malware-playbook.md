# Malware Infection Response Playbook

| Document Control | |
|-----------------|---|
| **Version** | [VERSION] |
| **Last Updated** | [DATE] |
| **Owner** | [ROLE - e.g., IT Security Manager] |
| **Classification** | Internal |

---

## 1. Overview

This playbook provides step-by-step guidance for responding to malware infections at [ORGANIZATION NAME]. This covers general malware incidents; for ransomware-specific guidance, see the [Ransomware Playbook](./ransomware-playbook.md).

### Malware Types Covered
- **Trojans**: Disguised malicious software
- **Worms**: Self-propagating malware
- **Spyware**: Information-stealing malware
- **Adware**: Unwanted advertising software
- **Rootkits**: Deep system compromise
- **Cryptominers**: Cryptocurrency mining malware
- **RATs**: Remote Access Trojans
- **Keyloggers**: Keystroke capture malware

---

## 2. Detection Indicators

### 2.1 Endpoint Indicators

| Indicator | Description |
|-----------|-------------|
| Antivirus/EDR alert | Detection of known malware |
| Unusual processes | Unknown or suspicious processes running |
| High resource usage | Unexplained CPU, memory, or network usage |
| Slow performance | System running abnormally slow |
| Pop-ups or browser changes | Unwanted ads, homepage changes |
| Disabled security software | AV or firewall unexpectedly disabled |
| Unusual files | Unknown executables, scripts |
| Modified system files | Changes to OS or application files |
| Unexpected network connections | Connections to unknown IPs |

### 2.2 Network Indicators

| Indicator | Description |
|-----------|-------------|
| Command & Control (C2) traffic | Communication with known malicious IPs |
| DNS anomalies | Queries to suspicious domains |
| Unusual outbound traffic | Large data transfers, odd protocols |
| Beaconing behavior | Regular, periodic connections |
| Network scanning | Internal reconnaissance activity |
| Lateral movement | Connections between systems |

### 2.3 User Reports

- Unusual system behavior
- Pop-ups or unwanted software
- Slow performance
- Suspicious emails clicked
- Unknown programs installed

---

## 3. Severity Assessment

| Level | Criteria | Response |
|-------|----------|----------|
| **P1 Critical** | Active data exfiltration, spreading rapidly, critical systems affected | Immediate, all hands |
| **P2 High** | Multiple systems infected, sensitive data at risk, spreading | Priority response |
| **P3 Medium** | Single system infected, contained, no sensitive data | Standard response |
| **P4 Low** | Adware/PUP, isolated, no business impact | Normal process |

---

## 4. Response Team

| Role | Responsibility | Contact |
|------|----------------|---------|
| Incident Commander | Overall coordination | [NAME/PHONE] |
| Security Analyst | Malware analysis, IoC development | [NAME/PHONE] |
| Endpoint Team | System isolation, remediation | [NAME/PHONE] |
| Network Team | Network containment, monitoring | [NAME/PHONE] |
| Help Desk | User communication, ticket tracking | [NAME/PHONE] |
| Management Contact | Escalation, decisions | [NAME/PHONE] |

---

## 5. Immediate Actions (First 30 Minutes)

### 5.1 Confirm and Assess

```
□ Step 1: Verify the infection
  - Review antivirus/EDR alert details
  - Check system for indicators
  - Gather initial information:
    • Affected system(s)
    • User(s) impacted
    • Malware name/type (if known)
    • Detection time
    • How detected

□ Step 2: Initial threat assessment
  - Identify malware type/family if possible
  - Check threat intelligence sources
  - Assess potential impact:
    • Data at risk
    • System criticality
    • Spreading potential

□ Step 3: Document initial findings
  - Create incident ticket
  - Record all initial observations
  - Capture screenshots/evidence
```

### 5.2 Containment Decision

```
□ Step 4: Make containment decision

  ISOLATE IMMEDIATELY if:
  - Active data exfiltration detected
  - Malware is spreading
  - Critical/sensitive data at risk
  - Ransomware indicators present
  - C2 communication active

  MONITOR AND ASSESS if:
  - Isolated incident
  - Low-risk malware (adware)
  - Need more information

□ Step 5: Notify response team
  - Alert appropriate team members
  - Establish communication channel
  - Begin coordination
```

---

## 6. Containment

### 6.1 Endpoint Isolation

```
□ Step 6: Isolate affected system(s)

  Option A - Network Isolation (Preferred):
  - Use EDR to isolate endpoint
  - Disable network adapter
  - Remove from network (unplug)
  - Block at switch port

  Option B - Logical Isolation:
  - Block all traffic from system at firewall
  - Quarantine in isolated VLAN
  - Disable user account

  ⚠️ DO NOT power off unless necessary
  (preserves evidence in memory)

□ Step 7: Preserve evidence
  - Capture memory dump (if possible)
  - Copy relevant logs
  - Document system state
  - Collect malware samples safely
```

### 6.2 Prevent Spread

```
□ Step 8: Block indicators of compromise (IoCs)

  At Firewall/Proxy:
  - Block known malicious IPs
  - Block malicious domains
  - Block C2 communication

  At Endpoint:
  - Push IoCs to EDR/AV
  - Block malicious file hashes
  - Quarantine similar files

□ Step 9: Identify scope
  - Search for IoCs across environment
  - Check for lateral movement
  - Identify all affected systems
  - Review recent authentication activity

□ Step 10: Protect credentials
  - Reset passwords for affected user(s)
  - Review privileged account usage
  - Consider broader password reset if needed
```

### 6.3 Network Containment

```
□ Step 11: Network-level containment
  - Monitor for spreading indicators
  - Enhance monitoring on critical segments
  - Block suspicious internal traffic
  - Isolate affected network segments if spreading
```

---

## 7. Investigation

### 7.1 Malware Analysis

```
□ Step 12: Analyze the malware

  Gather Information:
  - Malware name/family
  - File hash (MD5, SHA256)
  - File location and name
  - Registry modifications
  - Persistence mechanisms
  - Network indicators (IPs, domains)
  - Behavior analysis

  Intelligence Sources:
  - VirusTotal
  - Threat intelligence feeds
  - Vendor threat reports
  - MITRE ATT&CK mapping

□ Step 13: Determine infection vector
  - Email attachment?
  - Malicious link?
  - Drive-by download?
  - Removable media?
  - Exploited vulnerability?
  - Supply chain?

□ Step 14: Assess data impact
  - What data was accessible?
  - Evidence of data access?
  - Evidence of exfiltration?
  - Credential exposure?
```

### 7.2 Scope Determination

```
□ Step 15: Determine full scope
  - All affected systems identified
  - All affected users identified
  - Timeline established
  - Entry point confirmed
  - Lateral movement mapped

□ Step 16: Update IoC list
  - All file indicators
  - All network indicators
  - All behavior indicators
  - Share with security tools
```

---

## 8. Eradication

### 8.1 Malware Removal

```
□ Step 17: Remove malware

  Option A - Automated Remediation:
  - Run full AV/EDR scan
  - Use malware removal tools
  - Verify complete removal
  - Check for persistence

  Option B - Manual Remediation:
  - Remove malicious files
  - Clean registry entries
  - Remove scheduled tasks
  - Remove persistence mechanisms
  - Verify removal

  Option C - Rebuild (Recommended for severe infections):
  - Backup user data (scan first)
  - Reimage system
  - Restore from clean backup
  - Reinstall applications

□ Step 18: Verify eradication
  - Run multiple scan tools
  - Check for persistence mechanisms
  - Monitor for reinfection
  - Verify system integrity
```

### 8.2 Vulnerability Remediation

```
□ Step 19: Address root cause
  - Patch exploited vulnerabilities
  - Update software/applications
  - Fix misconfigurations
  - Block infection vector
  - Enhance controls
```

---

## 9. Recovery

### 9.1 System Restoration

```
□ Step 20: Restore affected systems

  Verification Before Reconnection:
  - [ ] Malware fully removed
  - [ ] System fully patched
  - [ ] AV/EDR updated and running
  - [ ] Passwords reset
  - [ ] Monitoring enhanced

□ Step 21: Reconnect to network
  - Remove isolation
  - Monitor closely for 24-48 hours
  - Watch for reinfection
  - Verify normal operation

□ Step 22: Restore user access
  - Re-enable user accounts
  - Provide new credentials
  - Brief user on incident
  - Return system to user
```

### 9.2 Monitoring

```
□ Step 23: Enhanced monitoring
  - Monitor recovered systems closely
  - Watch for IoCs across environment
  - Alert on any reoccurrence
  - Continue for 2-4 weeks minimum
```

---

## 10. Communication

### 10.1 Internal Communication

| Audience | When | Message |
|----------|------|---------|
| Affected User(s) | Immediately | System issue, investigation in progress |
| IT Teams | Immediately | Incident details, IoCs to monitor |
| Management | P1/P2: Immediate; P3/P4: Summary | Impact and response status |
| All Users | If broader risk | Awareness of threat, guidance |

### 10.2 User Notification Template

```
Subject: Security Incident - Action Required

[User Name],

Our security team has detected a potential security issue on your
computer. As a precaution, we have temporarily isolated your system
for investigation.

What you need to do:
1. Stop using the affected computer
2. Do not attempt to log in to other systems
3. Contact the IT Help Desk at [NUMBER]
4. Be prepared to have your password reset

Your patience is appreciated as we work to resolve this issue
and protect our systems.

IT Security Team
```

---

## 11. Post-Incident

### 11.1 Immediate Documentation

```
□ Step 24: Complete incident documentation
  - Full timeline of events
  - All systems affected
  - Actions taken
  - IoCs collected
  - Root cause determination
  - Business impact
```

### 11.2 Post-Incident Review (Within 1 Week)

```
□ Step 25: Conduct post-incident review

  Topics to Cover:
  - How was malware introduced?
  - Why wasn't it prevented?
  - How was it detected?
  - How effective was response?
  - What could improve?
  - What controls to add?

□ Step 26: Implement improvements
  - Update detection rules
  - Enhance prevention controls
  - Update training if needed
  - Patch vulnerabilities
  - Update playbook
```

---

## 12. Common Malware Response Reference

### 12.1 By Malware Type

| Type | Key Actions |
|------|-------------|
| **Trojan** | Isolate, analyze C2, check data access, full removal |
| **Worm** | Immediate isolation, network containment, patch vulnerability |
| **Spyware** | Isolate, credential reset, check data exfiltration |
| **Cryptominer** | Remove, check for backdoors, review how installed |
| **RAT** | Immediate isolation, assume full compromise, credential reset |
| **Rootkit** | Reimage required, cannot trust remediation |

### 12.2 Persistence Mechanisms to Check

| Location | What to Check |
|----------|---------------|
| Startup folders | Autostart programs |
| Registry Run keys | HKLM/HKCU Run, RunOnce |
| Scheduled Tasks | Malicious tasks |
| Services | Unknown services |
| WMI subscriptions | Event subscriptions |
| Browser extensions | Malicious add-ons |
| DLL hijacking | Modified DLLs |

---

## 13. Tools and Resources

| Tool | Purpose | Location |
|------|---------|----------|
| [EDR Platform] | Detection, isolation, response | [URL] |
| [Antivirus] | Scanning, removal | [URL] |
| [SIEM] | Log analysis | [URL] |
| [Threat Intel] | IoC lookup | [URL] |
| VirusTotal | Hash/URL analysis | virustotal.com |
| MITRE ATT&CK | Technique mapping | attack.mitre.org |

---

## 14. Related Documents

- [Incident Response Policy](../../policies/incident-response-policy.md)
- [Incident Response Procedure](../../procedures/incident-response-procedure.md)
- [Ransomware Playbook](./ransomware-playbook.md)
- [Phishing Playbook](./phishing-playbook.md)

---

## 15. Document History

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | [DATE] | [AUTHOR] | Initial release |

---

[Back to Playbooks](./README.md) | [Back to Crisis Management](../README.md)
